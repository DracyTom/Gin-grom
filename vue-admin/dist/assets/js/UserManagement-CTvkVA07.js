/* empty css             *//* empty css                   *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import{r as g,a as B,q as se,W as oe,c as re,b as h,d as a,w as t,e as ne,h as ue,l as de,i as ie,ag as pe,ah as me,s as L,ai as ce,ad as ge,aj as C,ak as _e,o as D,x as fe,t as v,al as q,m as ve,j as r,am as ye,a5 as be,an as Ve,ao as we,ae as he,L as U,E as Ce,y as xe,g as Ue,ap as Ee,aq as ke,af as x,V as R,ar as ze}from"./index-DRFz7__u.js";import{f as Se,v as Be}from"./index-D5zCzsRw.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Te={class:"user-management"},$e={class:"toolbar content-card"},Fe={class:"search-section"},Ie={class:"action-section"},Le={class:"table-container content-card"},qe={class:"pagination-container"},Re={__name:"UserManagement",setup(Me){const E=g(!1),k=g(!1),_=g(!1),y=g(!1),z=g([]),b=g([]),d=B({keyword:"",role:"",status:""}),n=B({page:1,size:10,total:0}),o=B({id:null,username:"",email:"",password:"",role:"user",status:1,avatar:""}),V=g(),M=se(()=>y.value?"编辑用户":"新增用户"),P={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:50,message:"用户名长度在 3 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(s,e,u)=>{Be(e)?u():u(new Error("请输入正确的邮箱格式"))},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于 6 个字符",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},i=async()=>{try{E.value=!0;const s={page:n.page,size:n.size,...d},e=await C.getUserList(s);z.value=e.data||e||[],n.total=e.total||z.value.length}catch(s){console.error("获取用户列表失败:",s)}finally{E.value=!1}},T=()=>{n.page=1,i()},j=()=>{d.keyword="",d.role="",d.status="",n.page=1,i()},N=s=>{n.size=s,n.page=1,i()},A=s=>{n.page=s,i()},K=s=>{b.value=s},G=()=>{y.value=!1,_.value=!0},O=s=>{y.value=!0,o.id=s.id,o.username=s.username,o.email=s.email,o.role=s.role,o.status=s.status,o.avatar=s.avatar||"",o.password="",_.value=!0},W=()=>{o.id=null,o.username="",o.email="",o.password="",o.role="user",o.status=1,o.avatar="",V.value&&V.value.clearValidate()},H=async()=>{if(V.value)try{if(await V.value.validate(),k.value=!0,y.value){const{id:s,password:e,...u}=o;await C.updateUser(s,u),x.success("用户更新成功")}else{const{id:s,...e}=o;await ze.register(e),x.success("用户创建成功")}_.value=!1,i()}catch(s){console.error("操作失败:",s)}finally{k.value=!1}},J=async s=>{try{const e=s.status===1?0:1;await C.updateUser(s.id,{status:e}),x.success(`用户${e===1?"启用":"禁用"}成功`),i()}catch(e){console.error("状态切换失败:",e)}},Q=s=>{R.confirm(`确定要删除用户 "${s.username}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await C.deleteUser(s.id),x.success("删除成功"),i()}catch(e){console.error("删除失败:",e)}})},X=()=>{const s=b.value.map(e=>e.username).join("、");R.confirm(`确定要删除选中的 ${b.value.length} 个用户吗？
用户：${s}`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=b.value.map(u=>C.deleteUser(u.id));await Promise.all(e),x.success("批量删除成功"),i()}catch(e){console.error("批量删除失败:",e)}})};return oe(()=>{i()}),(s,e)=>{const u=fe,w=ue,m=ve,S=de,p=ie,c=we,$=he,Y=_e,Z=ce,f=Ue,F=ke,ee=Ee,ae=Ce,le=ge,te=me;return D(),re("div",Te,[h("div",$e,[h("div",Fe,[a(w,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>d.keyword=l),placeholder:"搜索用户名或邮箱",style:{width:"300px"},clearable:"",onKeyup:ne(T,["enter"])},{prefix:t(()=>[a(u,null,{default:t(()=>[a(v(q))]),_:1})]),_:1},8,["modelValue"]),a(S,{modelValue:d.role,"onUpdate:modelValue":e[1]||(e[1]=l=>d.role=l),placeholder:"选择角色",style:{width:"120px","margin-left":"10px"},clearable:""},{default:t(()=>[a(m,{label:"全部",value:""}),a(m,{label:"用户",value:"user"}),a(m,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"]),a(S,{modelValue:d.status,"onUpdate:modelValue":e[2]||(e[2]=l=>d.status=l),placeholder:"选择状态",style:{width:"120px","margin-left":"10px"},clearable:""},{default:t(()=>[a(m,{label:"全部",value:""}),a(m,{label:"正常",value:1}),a(m,{label:"禁用",value:0})]),_:1},8,["modelValue"]),a(p,{type:"primary",onClick:T,style:{"margin-left":"10px"}},{default:t(()=>[a(u,null,{default:t(()=>[a(v(q))]),_:1}),e[13]||(e[13]=r(" 搜索 "))]),_:1,__:[13]}),a(p,{onClick:j},{default:t(()=>[a(u,null,{default:t(()=>[a(v(ye))]),_:1}),e[14]||(e[14]=r(" 重置 "))]),_:1,__:[14]})]),h("div",Ie,[a(p,{type:"primary",onClick:G},{default:t(()=>[a(u,null,{default:t(()=>[a(v(be))]),_:1}),e[15]||(e[15]=r(" 新增用户 "))]),_:1,__:[15]}),a(p,{type:"danger",disabled:!b.value.length,onClick:X},{default:t(()=>[a(u,null,{default:t(()=>[a(v(Ve))]),_:1}),e[16]||(e[16]=r(" 批量删除 "))]),_:1,__:[16]},8,["disabled"])])]),h("div",Le,[pe((D(),L(Y,{data:z.value,onSelectionChange:K,stripe:"",style:{width:"100%"}},{default:t(()=>[a(c,{type:"selection",width:"55"}),a(c,{prop:"id",label:"ID",width:"80"}),a(c,{prop:"username",label:"用户名","min-width":"120"}),a(c,{prop:"email",label:"邮箱","min-width":"180"}),a(c,{prop:"role",label:"角色",width:"100"},{default:t(({row:l})=>[a($,{type:l.role==="admin"?"danger":"primary"},{default:t(()=>[r(U(l.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[a($,{type:l.status===1?"success":"danger"},{default:t(()=>[r(U(l.status===1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"created_at",label:"创建时间",width:"180"},{default:t(({row:l})=>[r(U(v(Se)(l.created_at)),1)]),_:1}),a(c,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[a(p,{type:"primary",size:"small",onClick:I=>O(l)},{default:t(()=>e[17]||(e[17]=[r(" 编辑 ")])),_:2,__:[17]},1032,["onClick"]),a(p,{type:l.status===1?"warning":"success",size:"small",onClick:I=>J(l)},{default:t(()=>[r(U(l.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),a(p,{type:"danger",size:"small",onClick:I=>Q(l)},{default:t(()=>e[18]||(e[18]=[r(" 删除 ")])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,E.value]]),h("div",qe,[a(Z,{"current-page":n.page,"onUpdate:currentPage":e[3]||(e[3]=l=>n.page=l),"page-size":n.size,"onUpdate:pageSize":e[4]||(e[4]=l=>n.size=l),"page-sizes":[10,20,50,100],total:n.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:N,onCurrentChange:A},null,8,["current-page","page-size","total"])])]),a(le,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=l=>_.value=l),title:M.value,width:"600px",onClose:W},{footer:t(()=>[a(p,{onClick:e[11]||(e[11]=l=>_.value=!1)},{default:t(()=>e[21]||(e[21]=[r("取消")])),_:1,__:[21]}),a(p,{type:"primary",loading:k.value,onClick:H},{default:t(()=>e[22]||(e[22]=[r(" 确定 ")])),_:1,__:[22]},8,["loading"])]),default:t(()=>[a(ae,{ref_key:"userFormRef",ref:V,model:o,rules:P,"label-width":"100px"},{default:t(()=>[a(f,{label:"用户名",prop:"username"},{default:t(()=>[a(w,{modelValue:o.username,"onUpdate:modelValue":e[5]||(e[5]=l=>o.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(f,{label:"邮箱",prop:"email"},{default:t(()=>[a(w,{modelValue:o.email,"onUpdate:modelValue":e[6]||(e[6]=l=>o.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),y.value?xe("",!0):(D(),L(f,{key:0,label:"密码",prop:"password"},{default:t(()=>[a(w,{modelValue:o.password,"onUpdate:modelValue":e[7]||(e[7]=l=>o.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),a(f,{label:"角色",prop:"role"},{default:t(()=>[a(S,{modelValue:o.role,"onUpdate:modelValue":e[8]||(e[8]=l=>o.role=l),placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[a(m,{label:"普通用户",value:"user"}),a(m,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"状态",prop:"status"},{default:t(()=>[a(ee,{modelValue:o.status,"onUpdate:modelValue":e[9]||(e[9]=l=>o.status=l)},{default:t(()=>[a(F,{label:1},{default:t(()=>e[19]||(e[19]=[r("正常")])),_:1,__:[19]}),a(F,{label:0},{default:t(()=>e[20]||(e[20]=[r("禁用")])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"头像",prop:"avatar"},{default:t(()=>[a(w,{modelValue:o.avatar,"onUpdate:modelValue":e[10]||(e[10]=l=>o.avatar=l),placeholder:"请输入头像URL（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Xe=De(Re,[["__scopeId","data-v-080e7def"]]);export{Xe as default};
